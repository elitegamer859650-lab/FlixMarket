<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Flix Market</title>
    <link rel="icon" type="image/png" href="icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #6C63FF; --secondary: #FF6584; }
        body { background-color: #F7FAFC; font-family: 'Segoe UI', sans-serif; }
        
        .profile-header { background: linear-gradient(135deg, var(--primary), #8A84FF); height: 200px; border-radius: 0 0 40px 40px; }
        .avatar-large { width: 120px; height: 120px; border: 5px solid white; background: var(--secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px; color: white; margin-top: -60px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        /* Floating Shortcut Menu [cite: 2026-01-18] */
        .shortcut-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 10px 25px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); display: flex; gap: 20px; z-index: 1000; border: 1px solid rgba(108, 99, 255, 0.2); }
        .shortcut-item { color: #A0AEC0; font-size: 20px; transition: 0.3s; position: relative; }
        .shortcut-item:hover, .shortcut-item.active { color: var(--primary); }
        .shortcut-label { position: absolute; top: -45px; left: 50%; transform: translateX(-50%); background: #2D3748; color: white; padding: 4px 10px; border-radius: 6px; font-size: 10px; opacity: 0; transition: 0.3s; pointer-events: none; white-space: nowrap; }
        .shortcut-item:hover .shortcut-label { opacity: 1; }

        .stat-card { background: white; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="pb-24">

    <div class="profile-header w-full"></div>

    <div class="container mx-auto px-4">
        <div class="flex flex-col items-center">
            <div id="userAvatar" class="avatar-large font-bold">?</div>
            <h2 id="userName" class="text-2xl font-bold mt-4 text-gray-800">Loading User...</h2>
            <p id="userEmail" class="text-gray-500 mb-8">Please wait while we sync</p>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="stat-card cursor-pointer" onclick="location.href='my-posts.html'">
                <div class="text-3xl font-bold text-[#6C63FF]" id="postCount">0</div>
                <div class="text-sm text-gray-500 uppercase font-bold tracking-widest">My Ads</div>
            </div>
            <div class="stat-card cursor-pointer" onclick="location.href='favorites.html'">
                <div class="text-3xl font-bold text-[#FF6584]">0</div>
                <div class="text-sm text-gray-500 uppercase font-bold tracking-widest">Favorites</div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm overflow-hidden mb-6">
            <div class="p-4 border-b flex justify-between items-center cursor-pointer hover:bg-gray-50" onclick="location.href='my-posts.html'">
                <div class="flex items-center gap-4">
                    <i class="fas fa-list text-[#6C63FF]"></i>
                    <span class="font-semibold">Manage My Listings</span>
                </div>
                <i class="fas fa-chevron-right text-gray-300"></i>
            </div>
            <div class="p-4 border-b flex justify-between items-center cursor-pointer hover:bg-gray-50">
                <div class="flex items-center gap-4">
                    <i class="fas fa-cog text-gray-400"></i>
                    <span class="font-semibold">Account Settings</span>
                </div>
                <i class="fas fa-chevron-right text-gray-300"></i>
            </div>
            <div class="p-4 flex justify-between items-center cursor-pointer hover:bg-red-50 text-red-500" id="logoutBtn">
                <div class="flex items-center gap-4">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="font-bold">Log Out</span>
                </div>
            </div>
        </div>
    </div>

    <div class="shortcut-bar">
        <a href="index.html" class="shortcut-item"><i class="fas fa-home"></i><span class="shortcut-label">Home</span></a>
        <a href="categories.html" class="shortcut-item"><i class="fas fa-th-large"></i><span class="shortcut-label">Categories</span></a>
        <a href="add-post.html" class="shortcut-item" style="color: var(--secondary); font-size: 26px;"><i class="fas fa-plus-circle"></i><span class="shortcut-label">Sell</span></a>
        <a href="favorites.html" class="shortcut-item"><i class="fas fa-heart"></i><span class="shortcut-label">Favorites</span></a>
        <a href="profile.html" class="shortcut-item active"><i class="fas fa-user"></i><span class="shortcut-label">Account</span></a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, query, orderByChild, equalTo, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBMK252DCWEfxmancNHZ5kqdoNTRgbok7A",
            authDomain: "flix-market.firebaseapp.com",
            databaseURL: "https://flix-market-default-rtdb.firebaseio.com",
            projectId: "flix-market",
            storageBucket: "flix-market.firebasestorage.app",
            messagingSenderId: "459532909263",
            appId: "1:459532909263:web:a337f01f4d185d53e115ba"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Auth & Profile Sync [cite: 2026-01-18]
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('userName').innerText = user.email.split('@')[0].toUpperCase();
                document.getElementById('userEmail').innerText = user.email;
                document.getElementById('userAvatar').innerText = user.email[0].toUpperCase();

                // Get Post Count [cite: 2026-01-18]
                const postsRef = ref(db, 'listings');
                const userPostsQuery = query(postsRef, orderByChild('userId'), equalTo(user.uid));
                onValue(userPostsQuery, (snapshot) => {
                    const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
                    document.getElementById('postCount').innerText = count;
                });
            } else {
                window.location.href = 'auth.html'; // Redirect if not logged in [cite: 2026-01-18]
            }
        });

        // Logout Logic [cite: 2026-01-18]
        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => window.location.href = 'index.html');
        });
    </script>
</body>
</html>
