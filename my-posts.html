<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage My Ads - Flix Market</title>
    <link rel="icon" type="image/png" href="icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #6C63FF; --secondary: #FF6584; }
        body { background-color: #F7FAFC; font-family: 'Segoe UI', sans-serif; }
        
        .post-manage-card { background: white; border-radius: 15px; display: flex; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; transition: 0.3s; }
        .post-manage-card:hover { transform: scale(1.01); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .post-img { width: 120px; height: 120px; object-fit: cover; }
        
        /* Floating Shortcut Menu [cite: 2026-01-18] */
        .shortcut-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 10px 25px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); display: flex; gap: 20px; z-index: 1000; border: 1px solid rgba(108, 99, 255, 0.2); }
        .shortcut-item { color: #A0AEC0; font-size: 20px; transition: 0.3s; position: relative; }
        .shortcut-item:hover, .shortcut-item.active { color: var(--primary); }
    </style>
</head>
<body class="pb-24">

    <div class="bg-[#6C63FF] p-6 text-white text-center rounded-b-[40px] mb-8 shadow-lg">
        <h1 class="text-2xl font-bold">My Active Listings</h1>
        <p class="opacity-80 text-sm">Update or remove your items from the market</p>
    </div>

    <div class="container mx-auto px-4">
        <div id="loader" class="text-center py-10 font-bold text-gray-400">Loading your assets...</div>
        <div id="myPostsContainer">
            </div>
        
        <div id="emptyState" class="hidden text-center py-20">
            <i class="fas fa-folder-open text-5xl text-gray-200 mb-4"></i>
            <h3 class="text-xl font-bold text-gray-400">No Ads Found</h3>
            <button onclick="location.href='add-post.html'" class="mt-4 text-[#6C63FF] font-bold">Post your first ad now!</button>
        </div>
    </div>

    <div class="shortcut-bar">
        <a href="index.html" class="shortcut-item"><i class="fas fa-home"></i></a>
        <a href="categories.html" class="shortcut-item"><i class="fas fa-th-large"></i></a>
        <a href="add-post.html" class="shortcut-item" style="color: var(--secondary); font-size: 26px;"><i class="fas fa-plus-circle"></i></a>
        <a href="favorites.html" class="shortcut-item"><i class="fas fa-heart"></i></a>
        <a href="profile.html" class="shortcut-item"><i class="fas fa-user"></i></a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, query, orderByChild, equalTo, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBMK252DCWEfxmancNHZ5kqdoNTRgbok7A",
            authDomain: "flix-market.firebaseapp.com",
            databaseURL: "https://flix-market-default-rtdb.firebaseio.com",
            projectId: "flix-market",
            storageBucket: "flix-market.firebasestorage.app",
            messagingSenderId: "459532909263",
            appId: "1:459532909263:web:a337f01f4d185d53e115ba"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const postsRef = ref(db, 'listings');
                const userPostsQuery = query(postsRef, orderByChild('userId'), equalTo(user.uid));

                onValue(userPostsQuery, (snapshot) => {
                    const container = document.getElementById('myPostsContainer');
                    const loader = document.getElementById('loader');
                    const empty = document.getElementById('emptyState');
                    
                    container.innerHTML = '';
                    loader.style.display = 'none';

                    if (snapshot.exists()) {
                        empty.style.display = 'none';
                        const data = snapshot.val();
                        Object.keys(data).reverse().forEach(key => {
                            const post = data[key];
                            const card = document.createElement('div');
                            card.className = 'post-manage-card';
                            card.innerHTML = `
                                <img src="${post.imageUrl}" class="post-img">
                                <div class="p-4 flex-1 flex flex-col justify-between">
                                    <div>
                                        <h3 class="font-bold text-gray-800 truncate">${post.title}</h3>
                                        <p class="text-[#6C63FF] font-bold">Rs. ${post.price}</p>
                                    </div>
                                    <div class="flex gap-4 mt-2">
                                        <button onclick="window.deletePost('${key}')" class="text-red-500 text-sm font-bold"><i class="fas fa-trash"></i> Delete</button>
                                        <button class="text-gray-400 text-sm font-bold"><i class="fas fa-edit"></i> Edit</button>
                                    </div>
                                </div>`;
                            container.appendChild(card);
                        });
                    } else {
                        empty.style.display = 'block';
                    }
                });
            } else {
                window.location.href = 'auth.html';
            }
        });

        // Delete Function [cite: 2026-01-18]
        window.deletePost = (postId) => {
            if (confirm("Are you sure you want to remove this ad?")) {
                const postRef = ref(db, `listings/${postId}`);
                remove(postRef).then(() => {
                    alert("Ad removed successfully.");
                }).catch((err) => alert("Error: " + err.message));
            }
        };
    </script>
</body>
</html>
