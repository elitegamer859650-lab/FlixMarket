<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Results - Flix Market</title>
    <link rel="icon" type="image/png" href="icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
    <h2 class="text-2xl font-bold mb-6">Search Results for: <span id="queryText" class="text-[#6C63FF]"></span></h2>
    <div id="resultsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { apiKey: "AIzaSyBMK252DCWEfxmancNHZ5kqdoNTRgbok7A", databaseURL: "https://flix-market-default-rtdb.firebaseio.com", projectId: "flix-market" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const query = new URLSearchParams(window.location.search).get('q').toLowerCase();
        document.getElementById('queryText').innerText = `"${query}"`;

        onValue(ref(db, 'listings'), (snap) => {
            const container = document.getElementById('resultsGrid');
            const data = snap.val();
            if(data) {
                Object.keys(data).forEach(key => {
                    const post = data[key];
                    if(post.title.toLowerCase().includes(query)) {
                        const card = document.createElement('div');
                        card.className = "bg-white p-4 rounded-xl shadow-sm cursor-pointer";
                        card.onclick = () => window.location.href = `post.html?id=${key}`;
                        card.innerHTML = `<img src="${post.imageUrl}" class="h-40 w-full object-cover rounded-lg"><h3 class="font-bold mt-2">${post.title}</h3><p class="text-[#6C63FF] font-bold">Rs. ${post.price}</p>`;
                        container.appendChild(card);
                    }
                });
            }
        });
    </script>
</body>
</html>
